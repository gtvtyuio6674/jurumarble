<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ® íŒŒí‹°ê²Œì„ - ì˜¨ë¼ì¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Noto Sans KR', sans-serif; }
    .title-font { font-family: 'Black Han Sans', sans-serif; }
    
    .bg-party {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      position: relative;
      overflow: hidden;
    }
    .bg-party::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(255, 0, 128, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 40% 40%, rgba(255, 255, 0, 0.1) 0%, transparent 30%);
      pointer-events: none;
    }

    .bg-beer {
      background-color: #2C2416;
      background-image: 
        radial-gradient(ellipse at 20% 30%, rgba(244, 168, 54, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 70%, rgba(244, 168, 54, 0.1) 0%, transparent 50%);
    }

    .bg-roulette {
      background: linear-gradient(135deg, #0d0015 0%, #1a0a2e 50%, #0d0015 100%);
      background-image: 
        radial-gradient(ellipse at 30% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(236, 72, 153, 0.08) 0%, transparent 50%);
    }

    @keyframes slide-in-left { 0% { transform: translateX(-100px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
    @keyframes slide-in-right { 0% { transform: translateX(100px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
    @keyframes slide-in-up { 0% { transform: translateY(50px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
    @keyframes slide-in-down { 0% { transform: translateY(-50px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
    @keyframes fade-in-scale { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    @keyframes bounce-in { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
    @keyframes float { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-15px) rotate(2deg); } }
    @keyframes float-reverse { 0%, 100% { transform: translateY(0) rotate(2deg); } 50% { transform: translateY(-20px) rotate(-2deg); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px var(--glow-color, rgba(244, 168, 54, 0.4)); } 50% { box-shadow: 0 0 40px var(--glow-color, rgba(244, 168, 54, 0.7)); } }
    @keyframes sparkle { 0%, 100% { opacity: 0; transform: scale(0); } 50% { opacity: 1; transform: scale(1); } }
    @keyframes dice-roll { 0% { transform: rotate(0deg) scale(1); } 25% { transform: rotate(20deg) scale(1.15); } 50% { transform: rotate(-20deg) scale(1.1); } 75% { transform: rotate(10deg) scale(1.15); } 100% { transform: rotate(0deg) scale(1); } }
    @keyframes pour { 0% { transform: rotate(-30deg); } 50% { transform: rotate(-45deg); } 100% { transform: rotate(-30deg); } }
    @keyframes move-token { 0% { transform: scale(1); } 50% { transform: scale(1.3) translateY(-10px); } 100% { transform: scale(1); } }
    @keyframes result-pop { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
    @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
    @keyframes golden-glow { 0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.3); } 50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.5); } }
    @keyframes card-flip { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(90deg); } 100% { transform: rotateY(0deg); } }

    .animate-slide-left { animation: slide-in-left 0.5s ease-out forwards; }
    .animate-slide-right { animation: slide-in-right 0.5s ease-out forwards; }
    .animate-slide-up { animation: slide-in-up 0.5s ease-out forwards; }
    .animate-slide-down { animation: slide-in-down 0.5s ease-out forwards; }
    .animate-fade-scale { animation: fade-in-scale 0.6s ease-out forwards; }
    .animate-bounce-in { animation: bounce-in 0.5s ease-out; }
    .animate-float { animation: float 4s ease-in-out infinite; }
    .animate-float-reverse { animation: float-reverse 5s ease-in-out infinite; }
    .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .animate-sparkle { animation: sparkle 2s ease-in-out infinite; }
    .animate-dice-roll { animation: dice-roll 0.15s ease-in-out infinite; }
    .animate-pour { animation: pour 1s ease-in-out infinite; }
    .animate-move { animation: move-token 0.5s ease-out; }
    .animate-result-pop { animation: result-pop 0.6s ease-out forwards; }
    .animate-rainbow { animation: rainbow 3s linear infinite; }
    .animate-golden-glow { animation: golden-glow 1.5s ease-in-out infinite; }
    .animate-card-flip { animation: card-flip 0.6s ease-out; }

    .delay-100 { animation-delay: 0.1s; opacity: 0; }
    .delay-200 { animation-delay: 0.2s; opacity: 0; }
    .delay-300 { animation-delay: 0.3s; opacity: 0; }
    .delay-400 { animation-delay: 0.4s; opacity: 0; }
    .delay-500 { animation-delay: 0.5s; opacity: 0; }

    .card-glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
    .card-wood { background: linear-gradient(145deg, #4A3728 0%, #3D2E1F 50%, #2C2416 100%); border: 3px solid #5D4634; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    .card-dark { background: linear-gradient(145deg, #2d2d44 0%, #1a1a2e 50%, #16162a 100%); border: 2px solid #3d3d5c; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    .card-purple { background: linear-gradient(145deg, #1a0a2e 0%, #150820 50%, #0d0015 100%); border: 2px solid #4c2882; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .card-golden { background: linear-gradient(145deg, #b8860b 0%, #daa520 50%, #ffd700 100%); border: 3px solid #ffec8b; }

    .game-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
      border: 2px solid rgba(255,255,255,0.2);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }
    .game-card::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg) translateX(-100%);
      transition: transform 0.6s;
    }
    .game-card:hover::before { transform: rotate(45deg) translateX(100%); }
    .game-card:hover {
      transform: translateY(-10px) scale(1.03);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), 0 0 30px var(--card-glow, rgba(99, 102, 241, 0.3));
    }

    .tile-drink { background: linear-gradient(135deg, #D97706 0%, #B45309 100%); }
    .tile-game { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
    .tile-bonus { background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%); }
    .tile-move { background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%); }
    .tile-special { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); }
    .tile-free { background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); }
    .tile-start { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }

    .btn-primary { background: linear-gradient(180deg, #6366f1 0%, #4f46e5 100%); border: 2px solid #4338ca; box-shadow: 0 4px 0 #3730a3, 0 6px 15px rgba(99, 102, 241, 0.4); transition: all 0.15s; }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-primary:active { transform: translateY(2px); box-shadow: 0 2px 0 #3730a3; }

    .btn-beer { background: linear-gradient(180deg, #F4A836 0%, #D4891C 100%); border: 2px solid #B8731A; box-shadow: 0 4px 0 #8B5A14, 0 6px 15px rgba(244, 168, 54, 0.4); transition: all 0.15s; }
    .btn-beer:hover { transform: translateY(-2px); }
    .btn-beer:active { transform: translateY(2px); box-shadow: 0 2px 0 #8B5A14; }

    .btn-purple { background: linear-gradient(180deg, #a855f7 0%, #9333ea 100%); border: 2px solid #7e22ce; box-shadow: 0 4px 0 #6b21a8, 0 6px 15px rgba(168, 85, 247, 0.4); transition: all 0.15s; }
    .btn-purple:hover { transform: translateY(-2px); }
    .btn-purple:active { transform: translateY(2px); box-shadow: 0 2px 0 #6b21a8; }

    .btn-danger { background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%); border: 2px solid #b91c1c; box-shadow: 0 4px 0 #991b1b; transition: all 0.15s; }
    .btn-danger:hover { transform: translateY(-2px); }
    .btn-danger:active { transform: translateY(2px); box-shadow: 0 2px 0 #991b1b; }

    .btn-secondary { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); transition: all 0.15s; }
    .btn-secondary:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.5); }

    .btn-ghost { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: all 0.15s; }
    .btn-ghost:hover { background: rgba(255,255,255,0.15); }

    .input-dark { background: rgba(0,0,0,0.5); border: 2px solid rgba(139,92,246,0.3); color: white; transition: all 0.2s; }
    .input-dark:focus { border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139,92,246,0.2); outline: none; }
    .input-dark::placeholder { color: rgba(255,255,255,0.3); }

    .input-beer { background: rgba(0,0,0,0.3); border: 2px solid rgba(244, 168, 54, 0.3); color: white; }
    .input-beer:focus { border-color: #F4A836; box-shadow: 0 0 0 3px rgba(244,168,54,0.3); outline: none; }

    .player-token { box-shadow: 0 3px 6px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.3); border: 2px solid rgba(255,255,255,0.5); }

    .roulette-wheel { transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99); }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

    .kick-btn { opacity: 0; transition: opacity 0.2s; }
    .player-item:hover .kick-btn { opacity: 1; }

    .sparkle-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
    .sparkle { position: absolute; width: 10px; height: 10px; background: white; border-radius: 50%; animation: sparkle 3s ease-in-out infinite; }
  </style>
</head>
<body class="min-h-screen">
  <div id="app"></div>

  <script>
    // ============================================
    // ğŸ”Š ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ
    // ============================================
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let audioCtx = null;
    function initAudio() { if (!audioCtx) audioCtx = new AudioCtx(); }

    function playSound(type) {
      initAudio();
      if (!audioCtx) return;
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      const sounds = {
        click: () => { oscillator.frequency.setValueAtTime(800, audioCtx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1); },
        success: () => { oscillator.frequency.setValueAtTime(523, audioCtx.currentTime); oscillator.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1); oscillator.frequency.setValueAtTime(784, audioCtx.currentTime + 0.2); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3); },
        spin: () => { oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(100, audioCtx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(2000, audioCtx.currentTime + 0.5); gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.5); },
        win: () => { [523, 659, 784, 1047].forEach((freq, i) => { setTimeout(() => { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); osc.frequency.setValueAtTime(freq, audioCtx.currentTime); gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2); osc.start(); osc.stop(audioCtx.currentTime + 0.2); }, i * 100); }); },
        dice: () => { oscillator.type = 'square'; oscillator.frequency.setValueAtTime(200, audioCtx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.05); gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1); },
        mission: () => { oscillator.frequency.setValueAtTime(400, audioCtx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.15); gainNode.gain.setValueAtTime(0.25, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.2); },
        join: () => { oscillator.frequency.setValueAtTime(600, audioCtx.currentTime); oscillator.frequency.setValueAtTime(800, audioCtx.currentTime + 0.1); gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.2); },
        kick: () => { oscillator.frequency.setValueAtTime(400, audioCtx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.3); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.3); },
        golden: () => { oscillator.type = 'sine'; [880, 1108, 1318, 1760].forEach((freq, i) => { setTimeout(() => { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); osc.frequency.setValueAtTime(freq, audioCtx.currentTime); gain.gain.setValueAtTime(0.2, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); osc.start(); osc.stop(audioCtx.currentTime + 0.15); }, i * 80); }); }
      };
      if (sounds[type]) sounds[type]();
    }

    // ============================================
    // ğŸ”¥ Firebase ì„¤ì •
    // ============================================
    const firebaseConfig = {
      apiKey: "AIzaSyCafzk3QueRsvj4DiMht6bTyHs0_HT5Iuc",
      authDomain: "test-e3974.firebaseapp.com",
      databaseURL: "https://test-e3974-default-rtdb.firebaseio.com",
      projectId: "test-e3974",
      storageBucket: "test-e3974.firebasestorage.app",
      messagingSenderId: "572983111486",
      appId: "1:572983111486:web:ce4e3f897f8faa66c4866f",
      measurementId: "G-S8J76VQ7MF"
    };

    let db = null;
    let isFirebaseReady = false;
    
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.database();
      isFirebaseReady = firebaseConfig.apiKey !== "YOUR_API_KEY";
    } catch (e) {
      console.log("Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...");
    }

    // ============================================
    // ê²Œì„ ëª©ë¡
    // ============================================
    const GAMES = [
      { id: 'jurumarble', name: 'ì£¼ë£¨ë§ˆë¸”', emoji: 'ğŸº', description: 'ìˆ ì´ ìˆ ìˆ  ë„˜ì–´ê°€ëŠ” ë³´ë“œê²Œì„', color: 'from-amber-500 to-orange-600', glowColor: 'rgba(244, 168, 54, 0.4)', bgClass: 'bg-beer', minPlayers: 2, maxPlayers: 8, multiplayer: true },
      { id: 'roulette', name: 'ë£°ë ›', emoji: 'ğŸ¡', description: 'ìš´ëª…ì˜ ì›íŒ ëŒë¦¬ê¸°!', color: 'from-purple-500 to-pink-600', glowColor: 'rgba(168, 85, 247, 0.4)', bgClass: 'bg-roulette', solo: true },
      { id: 'coming-soon', name: 'ì¤€ë¹„ ì¤‘', emoji: 'ğŸ¯', description: 'ìƒˆë¡œìš´ ê²Œì„ì´ ê³§ ì¶”ê°€ë©ë‹ˆë‹¤!', color: 'from-gray-500 to-gray-600', disabled: true }
    ];

    // í™©ê¸ˆì—´ì‡  ì¹´ë“œ
    const GOLDEN_KEYS = [
      { emoji: 'ğŸº', text: 'ëª¨ë‘ í•œ ì”ì”©!', type: 'all-drink' },
      { emoji: 'ğŸ‰', text: 'ì´ë²ˆ í„´ ë©´ì œ! ì•„ë¬´ê²ƒë„ ì•ˆí•´ë„ ë¨', type: 'skip' },
      { emoji: 'ğŸ’¸', text: 'ë²Œê¸ˆ 1000ì› ë‚´ê¸°', type: 'penalty' },
      { emoji: 'ğŸ”„', text: 'ì™¼ìª½ ì‚¬ëŒê³¼ ìë¦¬ ë°”ê¾¸ê¸°', type: 'swap' },
      { emoji: 'ğŸ»', text: 'ì§€ëª©í•œ ì‚¬ëŒê³¼ ê±´ë°° í›„ ê°™ì´ í•œ ì”', type: 'cheers' },
      { emoji: 'ğŸ‘‘', text: 'ë‹¤ìŒ ë²Œì¹™ ë©´ì œê¶Œ íšë“!', type: 'immunity' },
      { emoji: 'ğŸ²', text: 'ì£¼ì‚¬ìœ„ í•œ ë²ˆ ë” êµ´ë¦¬ê¸°', type: 'extra-roll' },
      { emoji: 'â®ï¸', text: '3ì¹¸ ë’¤ë¡œ ê°€ê¸°', type: 'back-3' },
      { emoji: 'â­ï¸', text: '3ì¹¸ ì•ìœ¼ë¡œ ê°€ê¸°', type: 'forward-3' },
      { emoji: 'ğŸƒ', text: 'ì˜¤ë¥¸ìª½ ì‚¬ëŒ ëŒ€ì‹  ë²Œì¹™ ë°›ê¸°', type: 'take-penalty' },
      { emoji: 'ğŸ’°', text: 'ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ 100ì›ì”© ë°›ê¸°', type: 'collect' },
      { emoji: 'ğŸ¤', text: 'ë…¸ë˜ í•œ ì†Œì ˆ ë¶€ë¥´ê¸° (ëª»í•˜ë©´ 2ì”)', type: 'sing' },
      { emoji: 'ğŸ¤¸', text: 'ì§€ëª©í•œ ì‚¬ëŒ 2ì” ë§ˆì‹œê²Œ í•˜ê¸°', type: 'point-drink' },
      { emoji: 'ğŸ˜ˆ', text: 'ëª¨ë‘ ëˆˆì¹˜ê²Œì„! ê¼´ì°Œ 2ì”', type: 'nunchi' },
      { emoji: 'ğŸ”€', text: 'ì „ì› ìë¦¬ ì„ê¸° (ëœë¤)', type: 'shuffle' },
      { emoji: 'ğŸ¾', text: 'ì¶•í•˜í•©ë‹ˆë‹¤! ì•„ë¬´ì¼ë„ ì—†ìŒ', type: 'nothing' },
      { emoji: 'â˜ ï¸', text: 'í˜¼ì 3ì” ì›ìƒ·!', type: 'solo-3' },
      { emoji: 'ğŸ’€', text: 'ì¶œë°œì ìœ¼ë¡œ ëŒì•„ê°€ê¸°', type: 'go-start' },
    ];

    // ì£¼ë£¨ë§ˆë¸” íƒ€ì¼
    const TILES = [
      { id: 0, name: "ì¶œë°œ", type: "start", emoji: "ğŸš€", description: "ê²Œì„ ì‹œì‘! ëª¨ë‘ í™”ì´íŒ…!" },
      { id: 1, name: "ë§ì€í¸ ì§ ", type: "drink", emoji: "ğŸ»", description: "ë§ì€í¸ ì‚¬ëŒê³¼ ê±´ë°°í•˜ê³  í•œ ì”!" },
      { id: 2, name: "ì£¼ì‚¬ìœ„ í•œë²ˆ ë”", type: "bonus", emoji: "ğŸ²", description: "ëŸ­í‚¤! ì£¼ì‚¬ìœ„ë¥¼ í•œ ë²ˆ ë” êµ´ë ¤ìš”" },
      { id: 3, name: "3.6.9", type: "game", emoji: "ğŸ‘", description: "3.6.9 ê²Œì„! í‹€ë¦¬ë©´ ë²Œì£¼!" },
      { id: 4, name: "í‘ê¸°ì‚¬", type: "drink", emoji: "ğŸ¦¸â€â™‚ï¸", description: "í‘ê¸°ì‚¬ë¥¼ ì§€ëª©! ì—†ìœ¼ë©´ ë‘ ì”!" },
      { id: 5, name: "ë’¤ë¡œ 1ì¹¸", type: "move", emoji: "â¬…ï¸", description: "í•œ ì¹¸ ë’¤ë¡œ!" },
      { id: 6, name: "007", type: "game", emoji: "ğŸ”«", description: "007ë¹µ! ì§€ë©´ ë²Œì£¼!" },
      { id: 7, name: "í™©ê¸ˆì—´ì‡ ", type: "special", emoji: "ğŸ”‘", description: "í™©ê¸ˆì—´ì‡ ë¥¼ ë½‘ìœ¼ì„¸ìš”!" },
      { id: 8, name: "ë‹¤ê°™ì´ ì›ìƒ·", type: "drink", emoji: "ğŸ¥‚", description: "ëª¨ë‘ ì›ìƒ·!" },
      { id: 9, name: "ëˆˆì¹˜ê²Œì„", type: "game", emoji: "ğŸ‘€", description: "ë§ˆì§€ë§‰ ì‚¬ëŒ ë²Œì£¼!" },
      { id: 10, name: "ëœë¤ê²Œì„", type: "game", emoji: "ğŸ°", description: "ëœë¤ ë¯¸ë‹ˆê²Œì„!" },
      { id: 11, name: "ë’¤ë¡œ 3ì¹¸", type: "move", emoji: "âª", description: "ì„¸ ì¹¸ ë’¤ë¡œ!" },
      { id: 12, name: "ì‰¬ì–´ê°€ê¸°", type: "free", emoji: "ğŸ˜´", description: "ì‰¬ì–´ê°€ì„¸ìš”~" },
      { id: 13, name: "ëŸ¬ë¸Œìƒ·", type: "drink", emoji: "ğŸ’•", description: "ì›í•˜ëŠ” ì‚¬ëŒê³¼ ëŸ¬ë¸Œìƒ·!" },
      { id: 14, name: "ê·€ìš”ë¯¸", type: "game", emoji: "ğŸ¥°", description: "ê·€ìš”ë¯¸ 1~10!" },
      { id: 15, name: "31ê²Œì„", type: "game", emoji: "ğŸ”¢", description: "31 ì™¸ì¹˜ë©´ ë²Œì£¼!" },
      { id: 16, name: "ì§€ëª©", type: "drink", emoji: "ğŸ‘‰", description: "í•œ ëª… ì§€ëª©!" },
      { id: 17, name: "í™©ê¸ˆì—´ì‡ ", type: "special", emoji: "ğŸ”‘", description: "í™©ê¸ˆì—´ì‡ ë¥¼ ë½‘ìœ¼ì„¸ìš”!" },
      { id: 18, name: "ë§¥ëšœ", type: "drink", emoji: "ğŸº", description: "ëšœê»‘ íŠ•ê¸°ê¸°!" },
      { id: 19, name: "ì†ë³‘í˜¸", type: "game", emoji: "âœ‹", description: "ì†ê°€ë½ ê±¸ê¸°!" },
      { id: 20, name: "ì•„íŒŒíŠ¸", type: "game", emoji: "ğŸ¢", description: "ì•„íŒŒíŠ¸ ê²Œì„!" },
      { id: 21, name: "2ì” ë§ˆì…”", type: "drink", emoji: "ğŸ·", description: "2ì” ë§ˆì…”ë¼!" },
      { id: 22, name: "í™©ê¸ˆì—´ì‡ ", type: "special", emoji: "ğŸ”‘", description: "í™©ê¸ˆì—´ì‡ ë¥¼ ë½‘ìœ¼ì„¸ìš”!" },
      { id: 23, name: "Back", type: "move", emoji: "ğŸ”™", description: "ì²˜ìŒìœ¼ë¡œ! 6ì”!" },
    ];

    const RANDOM_GAMES = ["í›ˆë¯¼ì •ìŒ!", "ë”¸ê¸°ê²Œì„!", "ì´ˆì„±í€´ì¦ˆ!", "ì—…ë‹¤ìš´!", "ì§„ì‹¤orê±°ì§“!", "ë¬¼ìŒí‘œê²Œì„!"];
    const PLAYER_COLORS = ['#EAB308', '#3B82F6', '#22C55E', '#EF4444', '#A855F7', '#F97316', '#06B6D4', '#EC4899'];
    const ROULETTE_COLORS = ['#c53030', '#c05621', '#b7791f', '#276749', '#0d9488', '#2b6cb0', '#6b46c1', '#b83280', '#c53030', '#5a7a23', '#0891b2', '#7c3aed'];

    // ============================================
    // ìƒíƒœ ê´€ë¦¬
    // ============================================
    let state = {
      screen: 'home',
      selectedGame: null,
      roomCode: null,
      playerId: null,
      playerName: '',
      isHost: false,
      room: null,
      localDiceValue: 1,
      showLeaveConfirm: false,
      showKickConfirm: null,
      kicked: false,
      // ë£°ë › (ì†”ë¡œ)
      rouletteSlots: 4,
      rouletteNames: ['', '', '', ''],
      rouletteSpinning: false,
      rouletteResult: null,
      rouletteAngle: 0,
      // í™©ê¸ˆì—´ì‡ 
      goldenKeyCard: null,
    };

    let roomRef = null;
    let unsubscribe = null;

    // ì„¸ì…˜ ê´€ë¦¬
    function saveSession() {
      if (state.roomCode && state.playerId && state.playerName) {
        localStorage.setItem('partygame_session', JSON.stringify({
          roomCode: state.roomCode, playerId: state.playerId, playerName: state.playerName,
          gameId: state.selectedGame?.id, timestamp: Date.now()
        }));
      }
    }
    function loadSession() {
      try {
        const data = localStorage.getItem('partygame_session');
        if (data) {
          const s = JSON.parse(data);
          if (Date.now() - s.timestamp < 24*60*60*1000) return s;
        }
      } catch(e) {}
      return null;
    }
    function clearSession() { localStorage.removeItem('partygame_session'); }

    // ìœ í‹¸
    function generateRoomCode() { return Math.random().toString(36).substring(2, 8).toUpperCase(); }
    function generatePlayerId() { return 'player_' + Math.random().toString(36).substring(2, 9); }
    function getTilePosition(index) {
      const perSide = 6;
      if (index === 0) return { x: 0, y: 6 };
      if (index <= perSide) return { x: index, y: 6 };
      if (index <= perSide * 2) return { x: 6, y: 6 - (index - perSide) };
      if (index <= perSide * 3) return { x: 6 - (index - perSide * 2), y: 0 };
      return { x: 0, y: index - perSide * 3 };
    }
    function getPlayerOffset(pi, total) {
      const offsets = [[-12,-12],[12,-12],[-12,12],[12,12],[0,-18],[0,18],[-18,0],[18,0]];
      return offsets[pi] || [0,0];
    }

    // ============================================
    // Firebase í•¨ìˆ˜ (ì£¼ë£¨ë§ˆë¸”ìš©)
    // ============================================
    async function createRoom() {
      if (!isFirebaseReady) { alert('Firebase ì„¤ì • í•„ìš”!'); return; }
      playSound('success');
      const roomCode = generateRoomCode();
      const playerId = generatePlayerId();
      
      const roomData = {
        code: roomCode, gameId: state.selectedGame.id, hostId: playerId, status: 'waiting',
        players: { [playerId]: { id: playerId, name: state.playerName, position: 0, order: 0, connected: true } },
        currentTurn: 0, diceValue: 1, rolling: false, showMission: false, currentTileId: null,
        missionRandomGame: null, goldenKeyCard: null, lastAction: null, createdAt: Date.now()
      };
      await db.ref('rooms/' + roomCode).set(roomData);
      state.roomCode = roomCode; state.playerId = playerId; state.isHost = true; state.screen = 'lobby';
      saveSession(); subscribeToRoom(roomCode); render();
    }

    async function joinRoom(code) {
      if (!isFirebaseReady) { alert('Firebase ì„¤ì • í•„ìš”!'); return; }
      const snapshot = await db.ref('rooms/' + code).once('value');
      const room = snapshot.val();
      if (!room) { alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°©!'); return; }
      if (room.status !== 'waiting') { alert('ì´ë¯¸ ì‹œì‘ëœ ë°©!'); return; }
      const playerCount = Object.keys(room.players || {}).length;
      if (playerCount >= 8) { alert('ë°©ì´ ê°€ë“ ì°¸!'); return; }
      playSound('join');
      const playerId = generatePlayerId();
      await db.ref(`rooms/${code}/players/${playerId}`).set({ id: playerId, name: state.playerName, position: 0, order: playerCount, connected: true });
      state.roomCode = code; state.playerId = playerId; state.isHost = false;
      state.selectedGame = GAMES.find(g => g.id === room.gameId);
      state.screen = 'lobby';
      saveSession(); subscribeToRoom(code); render();
    }

    async function rejoinRoom() {
      const session = loadSession();
      if (!session || !isFirebaseReady) return;
      const snapshot = await db.ref('rooms/' + session.roomCode).once('value');
      const room = snapshot.val();
      if (!room) { alert('ë°© ì¢…ë£Œë¨'); clearSession(); render(); return; }
      if (!room.players[session.playerId]) { alert('ì œì™¸ë¨'); clearSession(); render(); return; }
      playSound('join');
      await db.ref(`rooms/${session.roomCode}/players/${session.playerId}/connected`).set(true);
      state.roomCode = session.roomCode; state.playerId = session.playerId; state.playerName = session.playerName;
      state.isHost = room.hostId === session.playerId;
      state.selectedGame = GAMES.find(g => g.id === session.gameId);
      state.screen = room.status === 'playing' ? 'game' : 'lobby';
      subscribeToRoom(session.roomCode); render();
    }

    function subscribeToRoom(code) {
      if (unsubscribe) unsubscribe();
      roomRef = db.ref('rooms/' + code);
      const callback = roomRef.on('value', (snapshot) => {
        const room = snapshot.val();
        if (!room || !room.players || !room.players[state.playerId]) {
          if (!state.kicked) { state.kicked = true; playSound('kick'); alert('ë°©ì—ì„œ ë‚˜ê°'); clearSession(); leaveRoomImmediate(); }
          return;
        }
        const wasShowingMission = state.room?.showMission;
        const hadGoldenKey = state.room?.goldenKeyCard;
        state.room = room; state.isHost = room.hostId === state.playerId;
        if (room.status === 'playing' && state.screen === 'lobby') { playSound('success'); state.screen = 'game'; }
        if (room.diceValue) state.localDiceValue = room.diceValue;
        if (!wasShowingMission && room.showMission) playSound('mission');
        if (!hadGoldenKey && room.goldenKeyCard) playSound('golden');
        state.goldenKeyCard = room.goldenKeyCard;
        render();
      });
      unsubscribe = () => roomRef.off('value', callback);
      db.ref(`rooms/${code}/players/${state.playerId}/connected`).onDisconnect().set(false);
    }

    async function leaveRoom() {
      state.showLeaveConfirm = false; playSound('click');
      if (state.roomCode && state.playerId) {
        await db.ref(`rooms/${state.roomCode}/players/${state.playerId}`).remove();
        if (state.isHost && state.room) {
          const remaining = Object.keys(state.room.players).filter(id => id !== state.playerId);
          if (remaining.length === 0) await db.ref(`rooms/${state.roomCode}`).remove();
          else await db.ref(`rooms/${state.roomCode}/hostId`).set(remaining[0]);
        }
      }
      leaveRoomImmediate();
    }

    function leaveRoomImmediate() {
      if (unsubscribe) unsubscribe();
      clearSession();
      state = { ...state, roomCode: null, playerId: null, room: null, isHost: false, selectedGame: null, kicked: false, screen: 'home', goldenKeyCard: null };
      render();
    }

    async function kickPlayer(playerId) {
      state.showKickConfirm = null;
      if (!state.isHost || playerId === state.playerId) return;
      playSound('kick');
      await db.ref(`rooms/${state.roomCode}/players/${playerId}`).remove();
    }

    async function startGame() {
      if (!state.isHost) return;
      const players = Object.values(state.room.players);
      const game = state.selectedGame;
      if (players.length < game.minPlayers) { alert(`ìµœì†Œ ${game.minPlayers}ëª… í•„ìš”!`); return; }
      await db.ref(`rooms/${state.roomCode}`).update({ status: 'playing', currentTurn: 0 });
    }

    // ì£¼ë£¨ë§ˆë¸” í•¨ìˆ˜ë“¤
    async function rollDice() {
      const room = state.room;
      const players = Object.values(room.players).sort((a,b) => a.order - b.order);
      const currentPlayer = players[room.currentTurn];
      if (currentPlayer.id !== state.playerId || room.rolling) return;
      playSound('dice');
      await db.ref(`rooms/${state.roomCode}/rolling`).set(true);
      let count = 0;
      const interval = setInterval(async () => {
        const val = Math.floor(Math.random() * 6) + 1;
        await db.ref(`rooms/${state.roomCode}/diceValue`).set(val);
        count++;
        if (count >= 15) {
          clearInterval(interval);
          const final = Math.floor(Math.random() * 6) + 1;
          const newPos = (currentPlayer.position + final) % TILES.length;
          const tile = TILES[newPos];
          let randomGame = tile.name === 'ëœë¤ê²Œì„' ? RANDOM_GAMES[Math.floor(Math.random() * RANDOM_GAMES.length)] : null;
          let goldenKey = tile.name === 'í™©ê¸ˆì—´ì‡ ' ? GOLDEN_KEYS[Math.floor(Math.random() * GOLDEN_KEYS.length)] : null;
          await db.ref(`rooms/${state.roomCode}`).update({
            diceValue: final, rolling: false, [`players/${currentPlayer.id}/position`]: newPos,
            showMission: true, currentTileId: newPos, missionRandomGame: randomGame, goldenKeyCard: goldenKey,
            lastAction: { playerId: currentPlayer.id, playerName: currentPlayer.name, value: final, newPosition: newPos, timestamp: Date.now() }
          });
        }
      }, 100);
    }

    async function closeMission(extraRoll = false) {
      const room = state.room;
      const players = Object.values(room.players).sort((a,b) => a.order - b.order);
      const currentPlayer = players[room.currentTurn];
      if (currentPlayer.id !== state.playerId) return;
      playSound('click');
      const tile = TILES[room.currentTileId];
      
      // í™©ê¸ˆì—´ì‡  íš¨ê³¼ ì²˜ë¦¬
      const goldenKey = room.goldenKeyCard;
      let extraRollFromGolden = false;
      if (goldenKey) {
        if (goldenKey.type === 'extra-roll') extraRollFromGolden = true;
        if (goldenKey.type === 'back-3') {
          const newPos = (currentPlayer.position - 3 + TILES.length) % TILES.length;
          await db.ref(`rooms/${state.roomCode}/players/${currentPlayer.id}/position`).set(newPos);
        }
        if (goldenKey.type === 'forward-3') {
          const newPos = (currentPlayer.position + 3) % TILES.length;
          await db.ref(`rooms/${state.roomCode}/players/${currentPlayer.id}/position`).set(newPos);
        }
        if (goldenKey.type === 'go-start') {
          await db.ref(`rooms/${state.roomCode}/players/${currentPlayer.id}/position`).set(0);
        }
      }
      
      // ì¼ë°˜ ì´ë™ íƒ€ì¼ ì²˜ë¦¬
      if (tile?.type === 'move' && !goldenKey) {
        let move = tile.name === 'ë’¤ë¡œ 1ì¹¸' ? -1 : tile.name === 'ë’¤ë¡œ 3ì¹¸' ? -3 : -currentPlayer.position;
        const newPos = (currentPlayer.position + move + TILES.length) % TILES.length;
        await db.ref(`rooms/${state.roomCode}/players/${currentPlayer.id}/position`).set(newPos);
      }
      
      await db.ref(`rooms/${state.roomCode}`).update({ showMission: false, currentTileId: null, missionRandomGame: null, goldenKeyCard: null });
      
      if (!extraRoll && !extraRollFromGolden && tile?.type !== 'bonus') {
        const nextTurn = (room.currentTurn + 1) % players.length;
        await db.ref(`rooms/${state.roomCode}/currentTurn`).set(nextTurn);
      }
    }

    // ============================================
    // ë£°ë › (ì†”ë¡œ ëª¨ë“œ)
    // ============================================
    function updateRouletteSlots(count) {
      const newNames = [...state.rouletteNames];
      while (newNames.length < count) newNames.push('');
      while (newNames.length > count) newNames.pop();
      state.rouletteSlots = count;
      state.rouletteNames = newNames;
      render();
    }

    function updateRouletteName(index, name) {
      state.rouletteNames[index] = name;
    }

    function spinRoulette() {
      if (state.rouletteSpinning) return;
      const names = state.rouletteNames.filter(n => n.trim());
      if (names.length < 2) { alert('ìµœì†Œ 2ê°œ ì´ìƒ ì…ë ¥!'); return; }
      
      playSound('spin');
      state.rouletteSpinning = true;
      state.rouletteResult = null;
      
      const slots = state.rouletteSlots;
      const resultIndex = Math.floor(Math.random() * slots);
      const spins = 5 + Math.random() * 3;
      const slotAngle = 360 / slots;
      const finalAngle = spins * 360 + (360 - resultIndex * slotAngle - slotAngle / 2);
      
      render(); // ë¨¼ì € spinning ìƒíƒœë¡œ ë Œë”ë§
      
      // DOMì´ ê·¸ë ¤ì§„ í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì£¼ê³  íšŒì „ ì‹œì‘
      requestAnimationFrame(() => {
        setTimeout(() => {
          const wheel = document.querySelector('.roulette-wheel');
          if (wheel) {
            wheel.style.transform = `rotate(${finalAngle}deg)`;
          }
        }, 50);
      });
      
      setTimeout(() => {
        state.rouletteSpinning = false;
        state.rouletteResult = resultIndex;
        state.rouletteAngle = finalAngle;
        playSound('win');
        render();
      }, 5100);
    }

    function resetRoulette() {
      state.rouletteSpinning = false;
      state.rouletteResult = null;
      state.rouletteAngle = 0;
      render();
    }

    // ============================================
    // ë Œë”ë§
    // ============================================
    function render() {
      const app = document.getElementById('app');
      switch (state.screen) {
        case 'home': app.innerHTML = renderHome(); break;
        case 'gameSelect': app.innerHTML = renderGameSelect(); break;
        case 'create': app.innerHTML = renderCreate(); break;
        case 'join': app.innerHTML = renderJoin(); break;
        case 'lobby': app.innerHTML = renderLobby(); break;
        case 'game': app.innerHTML = renderGame(); break;
        case 'roulette': app.innerHTML = renderRouletteSolo(); break;
      }
      bindEvents();
    }

    function bindEvents() {
      document.querySelectorAll('[data-action]').forEach(el => {
        el.onclick = (e) => {
          e.stopPropagation();
          const action = el.dataset.action;
          const sound = el.dataset.sound || 'click';
          playSound(sound);
          
          setTimeout(() => {
            switch(action) {
              case 'go-home': state.screen = 'home'; state.selectedGame = null; render(); break;
              case 'go-create': state.screen = 'create'; render(); break;
              case 'go-join': state.screen = 'join'; render(); break;
              case 'go-gameselect': state.screen = 'gameSelect'; render(); break;
              case 'go-roulette': state.selectedGame = GAMES.find(g => g.id === 'roulette'); state.screen = 'roulette'; render(); break;
              case 'select-game':
                const game = GAMES.find(g => g.id === el.dataset.gameId);
                if (game && !game.disabled) {
                  state.selectedGame = game;
                  if (game.solo) {
                    state.screen = 'roulette';
                  } else {
                    state.screen = 'gameSelect';
                  }
                  render();
                }
                break;
              case 'create-room':
                state.playerName = document.getElementById('hostName')?.value || '';
                if (state.playerName.trim()) createRoom(); else alert('ë‹‰ë„¤ì„ ì…ë ¥!');
                break;
              case 'join-room':
                state.playerName = document.getElementById('guestName')?.value || '';
                const code = document.getElementById('roomCode')?.value?.toUpperCase() || '';
                if (state.playerName.trim() && code.length === 6) joinRoom(code); else alert('í™•ì¸ í•„ìš”!');
                break;
              case 'rejoin': rejoinRoom(); break;
              case 'clear-session': clearSession(); render(); break;
              case 'start-game': startGame(); break;
              case 'roll-dice': rollDice(); break;
              case 'close-mission': closeMission(false); break;
              case 'extra-roll': closeMission(true); break;
              case 'copy-code': navigator.clipboard.writeText(state.roomCode); el.innerText = 'âœ“'; setTimeout(() => el.innerText = 'ğŸ“‹', 1000); break;
              case 'show-leave-confirm': state.showLeaveConfirm = true; render(); break;
              case 'hide-leave-confirm': state.showLeaveConfirm = false; render(); break;
              case 'leave-room': leaveRoom(); break;
              case 'show-kick-confirm': state.showKickConfirm = el.dataset.playerId; render(); break;
              case 'hide-kick-confirm': state.showKickConfirm = null; render(); break;
              case 'kick-player': kickPlayer(state.showKickConfirm); break;
              case 'spin-roulette': spinRoulette(); break;
              case 'reset-roulette': resetRoulette(); break;
              case 'roulette-slots': updateRouletteSlots(parseInt(el.dataset.count)); break;
            }
          }, 50);
        };
      });
      
      document.querySelectorAll('[data-roulette-input]').forEach(el => {
        el.oninput = (e) => updateRouletteName(parseInt(el.dataset.rouletteInput), e.target.value);
      });
    }

    function renderHome() {
      const session = loadSession();
      const sparkles = Array(20).fill(0).map((_, i) => 
        `<div class="sparkle" style="left: ${Math.random()*100}%; top: ${Math.random()*100}%; animation-delay: ${Math.random()*3}s; width: ${4+Math.random()*8}px; height: ${4+Math.random()*8}px;"></div>`
      ).join('');

      return `
        <div class="min-h-screen bg-party flex items-center justify-center p-6 relative">
          <div class="sparkle-container">${sparkles}</div>
          
          <div class="absolute top-10 left-10 text-6xl opacity-30 animate-float">ğŸ®</div>
          <div class="absolute top-20 right-16 text-5xl opacity-25 animate-float-reverse" style="animation-delay: 1s;">ğŸ²</div>
          <div class="absolute bottom-20 left-16 text-5xl opacity-25 animate-float" style="animation-delay: 0.5s;">ğŸ¯</div>
          <div class="absolute bottom-16 right-10 text-6xl opacity-30 animate-float-reverse" style="animation-delay: 1.5s;">ğŸª</div>
          <div class="absolute top-1/3 left-1/4 text-4xl opacity-20 animate-float" style="animation-delay: 2s;">âœ¨</div>
          <div class="absolute top-1/2 right-1/4 text-4xl opacity-20 animate-float-reverse" style="animation-delay: 2.5s;">ğŸŒŸ</div>

          <div class="text-center max-w-5xl mx-auto relative z-10">
            <div class="mb-6 animate-fade-scale">
              <div class="text-8xl mb-4 animate-float">ğŸ®</div>
              <h1 class="title-font text-7xl text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 animate-rainbow"
                  style="text-shadow: 0 0 30px rgba(168, 85, 247, 0.5);">
                íŒŒí‹°ê²Œì„
              </h1>
            </div>
            <p class="text-xl text-purple-200/80 mb-8 animate-fade-scale delay-100">ğŸ‰ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ì˜¨ë¼ì¸ íŒŒí‹°ê²Œì„ ğŸ‰</p>
            
            ${session ? `
              <div class="mb-10 animate-slide-down delay-200">
                <button data-action="rejoin" data-sound="success" class="btn-primary px-10 py-4 text-white font-bold text-xl rounded-2xl">
                  ğŸ”„ ë‹¤ì‹œ ì°¸ì—¬í•˜ê¸°
                </button>
                <p class="text-purple-300/60 text-sm mt-3">
                  ${session.playerName} Â· ${session.roomCode}
                  <button data-action="clear-session" class="ml-2 text-red-400 hover:text-red-300">âœ•</button>
                </p>
              </div>
            ` : ''}

            <h2 class="text-2xl font-bold text-white mb-8 animate-fade-scale delay-200">
              <span class="text-yellow-400">â­</span> ê²Œì„ ì„ íƒ <span class="text-yellow-400">â­</span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
              ${GAMES.map((game, i) => `
                <div data-action="select-game" data-game-id="${game.id}" data-sound="${game.disabled ? 'error' : 'success'}"
                  class="game-card rounded-3xl p-8 cursor-pointer animate-slide-up ${game.disabled ? 'opacity-40 cursor-not-allowed' : ''}"
                  style="animation-delay: ${0.3 + i * 0.15}s; opacity: 0; --card-glow: ${game.glowColor || 'rgba(99, 102, 241, 0.3)'}">
                  <div class="text-7xl mb-4 ${!game.disabled ? 'animate-float' : ''}" style="animation-delay: ${i * 0.2}s;">${game.emoji}</div>
                  <h3 class="text-2xl font-bold text-white mb-2">${game.name}</h3>
                  <p class="text-white/60 text-sm mb-3">${game.description}</p>
                  ${!game.disabled ? `
                    <span class="inline-block px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r ${game.color} text-white">
                      ${game.solo ? 'ì†”ë¡œ' : `${game.minPlayers}-${game.maxPlayers}ëª…`}
                    </span>
                  ` : '<span class="text-gray-500 text-xs">Coming Soon</span>'}
                </div>
              `).join('')}
            </div>

            ${!isFirebaseReady ? `
              <div class="mt-10 p-4 bg-red-900/50 border border-red-500/50 rounded-xl text-red-200 max-w-md mx-auto animate-fade-scale delay-600">
                <p class="font-bold">âš ï¸ Firebase ì„¤ì • í•„ìš” (ë©€í‹°í”Œë ˆì´ìš©)</p>
                <p class="text-sm mt-1">ë£°ë ›ì€ ë°”ë¡œ í”Œë ˆì´ ê°€ëŠ¥!</p>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    function renderGameSelect() {
      const game = state.selectedGame;
      if (!game) { state.screen = 'home'; render(); return ''; }
      
      return `
        <div class="min-h-screen ${game.bgClass} flex items-center justify-center p-8 relative overflow-hidden">
          <div class="absolute top-10 left-10 text-6xl opacity-20 animate-float">ğŸº</div>
          <div class="absolute top-20 right-20 text-5xl opacity-15 animate-float" style="animation-delay: 1s;">ğŸ»</div>
          <div class="absolute bottom-20 left-20 text-5xl opacity-15 animate-float" style="animation-delay: 2s;">ğŸ¥‚</div>
          <div class="absolute bottom-10 right-10 text-6xl opacity-20 animate-float" style="animation-delay: 0.5s;">ğŸ¾</div>

          <button data-action="go-home" class="absolute top-6 left-6 btn-ghost px-4 py-2 text-white rounded-xl z-20">â† ê²Œì„ ëª©ë¡</button>

          <div class="text-center relative z-10">
            <div class="mb-8 animate-fade-scale">
              <span class="text-9xl animate-float">${game.emoji}</span>
            </div>
            <h1 class="title-font text-7xl text-white mb-4 animate-fade-scale delay-100">${game.name}</h1>
            <p class="text-xl text-white/70 mb-12 animate-fade-scale delay-200">${game.description}</p>
            
            <div class="flex flex-col gap-4 max-w-sm mx-auto">
              <button data-action="go-create" class="btn-beer w-full py-5 px-8 text-white font-bold text-xl rounded-2xl animate-slide-left delay-300">
                ğŸ® ë°© ë§Œë“¤ê¸°
              </button>
              <button data-action="go-join" class="btn-secondary w-full py-5 px-8 text-white font-bold text-xl rounded-2xl animate-slide-right delay-400">
                ğŸšª ì°¸ê°€í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderCreate() {
      const game = state.selectedGame;
      return `
        <div class="min-h-screen ${game?.bgClass || 'bg-party'} flex items-center justify-center p-8">
          <div class="card-wood rounded-3xl p-8 max-w-md w-full animate-fade-scale">
            <button data-action="go-gameselect" class="text-white/70 hover:text-white mb-4">â† ë’¤ë¡œ</button>
            <div class="text-center mb-6">
              <span class="text-5xl">${game?.emoji || 'ğŸ®'}</span>
              <h2 class="title-font text-3xl text-white mt-2">ë°© ë§Œë“¤ê¸°</h2>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-white/80 font-bold mb-2">ë‹‰ë„¤ì„</label>
                <input type="text" id="hostName" maxlength="10" placeholder="ë‹‰ë„¤ì„"
                  class="input-beer w-full px-4 py-3 rounded-xl text-lg" value="${state.playerName}">
              </div>
              <button data-action="create-room" data-sound="success" class="btn-beer w-full py-4 text-white font-bold text-xl rounded-2xl">
                ğŸ² ë°© ìƒì„±í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderJoin() {
      const game = state.selectedGame;
      return `
        <div class="min-h-screen ${game?.bgClass || 'bg-party'} flex items-center justify-center p-8">
          <div class="card-wood rounded-3xl p-8 max-w-md w-full animate-fade-scale">
            <button data-action="go-gameselect" class="text-white/70 hover:text-white mb-4">â† ë’¤ë¡œ</button>
            <div class="text-center mb-6">
              <span class="text-5xl">${game?.emoji || 'ğŸ®'}</span>
              <h2 class="title-font text-3xl text-white mt-2">ë°© ì°¸ê°€í•˜ê¸°</h2>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-white/80 font-bold mb-2">ë‹‰ë„¤ì„</label>
                <input type="text" id="guestName" maxlength="10" placeholder="ë‹‰ë„¤ì„"
                  class="input-beer w-full px-4 py-3 rounded-xl text-lg" value="${state.playerName}">
              </div>
              <div>
                <label class="block text-white/80 font-bold mb-2">ë°© ì½”ë“œ</label>
                <input type="text" id="roomCode" maxlength="6" placeholder="6ìë¦¬ ì½”ë“œ"
                  class="input-beer w-full px-4 py-3 rounded-xl text-lg text-center tracking-[0.3em] uppercase font-mono">
              </div>
              <button data-action="join-room" data-sound="join" class="btn-beer w-full py-4 text-white font-bold text-xl rounded-2xl">
                ğŸš€ ì…ì¥í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderLobby() {
      if (!state.room) return '<div class="min-h-screen flex items-center justify-center"><span class="text-white text-2xl">ë¡œë”©...</span></div>';
      const game = state.selectedGame;
      const players = Object.values(state.room.players || {}).sort((a,b) => a.order - b.order);
      
      return `
        <div class="min-h-screen ${game?.bgClass || 'bg-party'} flex items-center justify-center p-8">
          <div class="card-wood rounded-3xl p-8 max-w-lg w-full animate-fade-scale">
            <div class="flex justify-between items-start mb-4">
              <div></div>
              <button data-action="show-leave-confirm" class="btn-ghost px-3 py-1 text-red-400 hover:text-red-300 rounded-lg text-sm">ğŸšª ë‚˜ê°€ê¸°</button>
            </div>
            
            <div class="text-center mb-6">
              <span class="text-5xl">${game?.emoji || 'ğŸ®'}</span>
              <h2 class="title-font text-3xl text-white mt-2">ëŒ€ê¸°ì‹¤</h2>
              <div class="flex items-center justify-center gap-3 mt-4">
                <span class="text-white/70">ë°© ì½”ë“œ</span>
                <span class="text-2xl font-black text-amber-400 tracking-[0.2em] font-mono bg-black/30 px-4 py-1 rounded-lg">${state.roomCode}</span>
                <button data-action="copy-code" class="text-white/70 hover:text-white text-xl">ğŸ“‹</button>
              </div>
            </div>
            
            <div class="mb-6">
              <p class="text-white/70 text-center mb-3">ì°¸ê°€ì (${players.length}/${game?.maxPlayers || 8})</p>
              <div class="grid grid-cols-2 gap-3">
                ${players.map((p, i) => `
                  <div class="player-item flex items-center gap-3 p-3 rounded-xl ${p.id === state.playerId ? 'bg-amber-500/20 ring-2 ring-amber-500' : 'bg-black/20'} ${!p.connected ? 'opacity-50' : ''}">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg player-token" style="background-color: ${PLAYER_COLORS[i]}">${p.name[0]}</div>
                    <div class="flex-1 min-w-0">
                      <p class="font-bold text-white truncate">${p.name}</p>
                      <div class="flex items-center gap-1">
                        ${p.id === state.room.hostId ? '<span class="text-xs text-amber-400">ğŸ‘‘</span>' : ''}
                        ${p.id === state.playerId ? '<span class="text-xs text-green-400">â† ë‚˜</span>' : ''}
                      </div>
                    </div>
                    ${state.isHost && p.id !== state.playerId ? `<button data-action="show-kick-confirm" data-player-id="${p.id}" class="kick-btn text-red-400 hover:text-red-300 text-sm">ì¶”ë°©</button>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
            
            ${state.isHost ? `
              <button data-action="start-game" data-sound="success"
                ${players.length < (game?.minPlayers || 2) ? 'disabled' : ''}
                class="w-full py-4 font-bold text-xl rounded-2xl ${players.length < (game?.minPlayers || 2) ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'btn-beer text-white'}">
                ${players.length < (game?.minPlayers || 2) ? `â³ ìµœì†Œ ${game?.minPlayers || 2}ëª… í•„ìš”` : 'ğŸ® ê²Œì„ ì‹œì‘!'}
              </button>
            ` : `<div class="text-center py-4 text-white/70 bg-black/20 rounded-xl animate-pulse">â³ ë°©ì¥ì´ ì‹œì‘í•˜ë©´...</div>`}
          </div>
          ${state.showLeaveConfirm ? renderLeaveModal() : ''}
          ${state.showKickConfirm ? renderKickModal() : ''}
        </div>
      `;
    }

    function renderGame() {
      if (!state.room) return '';
      return renderJurumarble();
    }

    function renderJurumarble() {
      const room = state.room;
      const players = Object.values(room.players).sort((a,b) => a.order - b.order);
      const currentPlayer = players[room.currentTurn];
      const isMyTurn = currentPlayer?.id === state.playerId;
      const tileSize = 80, gap = 4;

      return `
        <div class="min-h-screen bg-beer p-4 lg:p-6 relative">
          <div class="absolute top-10 left-10 text-5xl opacity-15 animate-float">ğŸº</div>
          <div class="absolute bottom-10 right-10 text-5xl opacity-15 animate-float" style="animation-delay:1s;">ğŸ»</div>
          
          <div class="max-w-7xl mx-auto relative z-10">
            <div class="flex justify-between items-center mb-4">
              <div></div>
              <h1 class="title-font text-4xl lg:text-5xl text-amber-400" style="text-shadow: 0 2px 10px rgba(0,0,0,0.5);">ğŸº ì£¼ë£¨ë§ˆë¸” ğŸº</h1>
              <button data-action="show-leave-confirm" class="btn-ghost px-4 py-2 text-red-400 rounded-xl">ğŸšª</button>
            </div>
            
            <div class="flex flex-col xl:flex-row items-center xl:items-start justify-center gap-6">
              <div class="relative rounded-3xl p-3 shadow-2xl card-wood" style="width:${(tileSize+gap)*7+24}px;height:${(tileSize+gap)*7+24}px;">
                <div class="absolute rounded-2xl flex items-center justify-center bg-gradient-to-br from-amber-900/50 to-amber-950/50 border border-amber-700/30"
                  style="left:${tileSize+gap+12}px;top:${tileSize+gap+12}px;width:${(tileSize+gap)*5-gap}px;height:${(tileSize+gap)*5-gap}px;">
                  <div class="text-center">
                    <div class="text-5xl mb-2 ${room.rolling ? 'animate-pour' : ''}">ğŸº</div>
                    <div class="title-font text-2xl text-amber-400">ì£¼ë£¨ë§ˆë¸”</div>
                  </div>
                </div>
                ${TILES.map((tile,idx) => {
                  const pos = getTilePosition(idx);
                  const here = players.filter(p => p.position === idx);
                  return `
                    <div class="absolute rounded-xl flex flex-col items-center justify-center tile-${tile.type} border border-white/20"
                      style="width:${tileSize}px;height:${tileSize}px;left:${pos.x*(tileSize+gap)+12}px;top:${pos.y*(tileSize+gap)+12}px;">
                      <span class="text-xl">${tile.emoji}</span>
                      <span class="text-[10px] font-bold text-white text-center px-1 drop-shadow">${tile.name}</span>
                      ${here.map((p,pi) => {
                        const pIdx = players.findIndex(pl => pl.id === p.id);
                        const [ox,oy] = getPlayerOffset(pi, here.length);
                        return `<div class="absolute w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold text-white player-token ${room.lastAction?.playerId === p.id && Date.now() - room.lastAction?.timestamp < 1000 ? 'animate-move' : ''}" style="background-color:${PLAYER_COLORS[pIdx]};transform:translate(${ox}px,${oy}px);z-index:10;">${p.name[0]}</div>`;
                      }).join('')}
                    </div>
                  `;
                }).join('')}
              </div>

              <div class="card-wood rounded-3xl p-5 shadow-xl w-full xl:w-80">
                <div class="text-center mb-5 p-4 rounded-2xl ${isMyTurn ? 'bg-amber-500/20' : 'bg-black/20'}">
                  <p class="text-amber-300/70 text-sm mb-1">í˜„ì¬ ì°¨ë¡€</p>
                  <p class="text-2xl font-black ${isMyTurn ? 'text-amber-400' : 'text-amber-100'}">${currentPlayer?.name || ''}</p>
                  ${isMyTurn ? '<p class="text-amber-400 text-sm mt-1">ğŸ² ì£¼ì‚¬ìœ„!</p>' : '<p class="text-amber-300/50 text-sm mt-1">ëŒ€ê¸° ì¤‘...</p>'}
                </div>
                
                <div class="flex justify-center mb-5">
                  <button data-action="roll-dice" data-sound="dice" ${!isMyTurn || room.rolling ? 'disabled' : ''}
                    class="relative w-24 h-24 bg-gradient-to-br from-amber-100 to-amber-200 rounded-2xl shadow-xl border-4 ${isMyTurn && !room.rolling ? 'border-amber-500 hover:scale-110 hover:rotate-6 cursor-pointer' : 'border-gray-600 opacity-50 cursor-not-allowed'} transition-all ${room.rolling ? 'animate-dice-roll' : ''}">
                    <svg viewBox="0 0 100 100" class="w-full h-full p-2">${renderDiceDots(state.localDiceValue)}</svg>
                  </button>
                </div>
                
                ${room.rolling ? `<div class="text-center mb-4 text-amber-300 animate-pulse">ğŸ² êµ´ë¦¬ëŠ” ì¤‘...</div>` : ''}

                <div class="border-t border-amber-700/30 pt-4">
                  <p class="text-amber-300/70 text-sm mb-3 text-center">í”Œë ˆì´ì–´</p>
                  <div class="space-y-2 max-h-52 overflow-y-auto">
                    ${players.map((p,i) => `
                      <div class="flex items-center gap-3 px-3 py-2 rounded-xl ${p.id === currentPlayer?.id ? 'bg-amber-500/20' : 'bg-black/20'} ${p.id === state.playerId ? 'ring-1 ring-amber-500/50' : ''}">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold player-token" style="background-color:${PLAYER_COLORS[i]}">${p.name[0]}</div>
                        <span class="flex-1 font-medium ${p.id === currentPlayer?.id ? 'text-amber-400' : 'text-amber-100'}">${p.name}${p.id === state.playerId ? ' <span class="text-green-400 text-xs">(ë‚˜)</span>' : ''}</span>
                        <span class="text-amber-300/50 text-sm">${p.position}</span>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>
            </div>
          </div>
          ${room.showMission && room.currentTileId !== null ? renderMissionModal() : ''}
          ${state.showLeaveConfirm ? renderLeaveModal() : ''}
        </div>
      `;
    }

    function renderRouletteSolo() {
      const slots = state.rouletteSlots;
      const names = state.rouletteNames;
      const spinning = state.rouletteSpinning;
      const result = state.rouletteResult;
      const angle = state.rouletteAngle;

      const slotAngle = 360 / slots;
      const wheelSegments = Array(slots).fill(0).map((_, i) => {
        const startAngle = i * slotAngle - 90;
        const endAngle = startAngle + slotAngle;
        const startRad = startAngle * Math.PI / 180;
        const endRad = endAngle * Math.PI / 180;
        const x1 = 150 + 140 * Math.cos(startRad);
        const y1 = 150 + 140 * Math.sin(startRad);
        const x2 = 150 + 140 * Math.cos(endRad);
        const y2 = 150 + 140 * Math.sin(endRad);
        const largeArc = slotAngle > 180 ? 1 : 0;
        const midAngle = (startAngle + endAngle) / 2;
        const midRad = midAngle * Math.PI / 180;
        const textX = 150 + 90 * Math.cos(midRad);
        const textY = 150 + 90 * Math.sin(midRad);
        return { path: `M150,150 L${x1},${y1} A140,140 0 ${largeArc},1 ${x2},${y2} Z`, color: ROULETTE_COLORS[i % ROULETTE_COLORS.length], textX, textY, textAngle: midAngle + 90, name: names[i] || '' };
      });

      return `
        <div class="min-h-screen bg-roulette p-4 lg:p-6 relative overflow-hidden">
          <div class="absolute top-10 left-10 text-5xl opacity-15 animate-float">ğŸ¡</div>
          <div class="absolute bottom-10 right-10 text-5xl opacity-15 animate-float-reverse">âœ¨</div>
          
          <div class="max-w-4xl mx-auto relative z-10">
            <div class="flex justify-between items-center mb-6">
              <button data-action="go-home" class="btn-ghost px-4 py-2 text-white rounded-xl">â† ëŒì•„ê°€ê¸°</button>
              <h1 class="title-font text-4xl lg:text-5xl text-purple-400" style="text-shadow: 0 0 15px rgba(139,92,246,0.3);">ğŸ¡ ë£°ë › ğŸ¡</h1>
              <div></div>
            </div>

            <div class="flex flex-col lg:flex-row items-center justify-center gap-8">
              <div class="relative">
                <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 z-20">
                  <div class="w-0 h-0 border-l-[20px] border-r-[20px] border-t-[40px] border-l-transparent border-r-transparent border-t-yellow-400" style="filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));"></div>
                </div>
                
                <div class="relative w-[320px] h-[320px]">
                  <svg viewBox="0 0 300 300" class="w-full h-full roulette-wheel" style="transform: rotate(${spinning ? 0 : angle}deg);">
                    ${wheelSegments.map((seg, i) => `
                      <path d="${seg.path}" fill="${seg.color}" stroke="#1a0a2e" stroke-width="2"/>
                      <text x="${seg.textX}" y="${seg.textY}" fill="white" font-size="14" font-weight="bold" text-anchor="middle" dominant-baseline="middle" transform="rotate(${seg.textAngle}, ${seg.textX}, ${seg.textY})">${seg.name.slice(0,6)}</text>
                    `).join('')}
                    <circle cx="150" cy="150" r="25" fill="#1a0a2e" stroke="#6b3fa0" stroke-width="3"/>
                    <text x="150" y="150" fill="white" font-size="20" text-anchor="middle" dominant-baseline="middle">ğŸ¡</text>
                  </svg>
                </div>
              </div>

              <div class="card-purple rounded-3xl p-6 w-full lg:w-96">
                ${result !== null && !spinning ? `
                  <div class="text-center mb-6 animate-result-pop">
                    <div class="text-6xl mb-2">ğŸ‰</div>
                    <p class="text-purple-300 text-lg">ë‹¹ì²¨!</p>
                    <p class="text-4xl font-black text-white mt-2" style="color: ${ROULETTE_COLORS[result % ROULETTE_COLORS.length]}; text-shadow: 0 0 10px rgba(0,0,0,0.5);">${names[result] || '???'}</p>
                  </div>
                ` : ''}

                <div class="mb-6">
                  <label class="block text-purple-300 font-bold mb-2">ì¹¸ ìˆ˜ (${slots}ê°œ)</label>
                  <div class="flex gap-2 flex-wrap">
                    ${[2,3,4,5,6,8,10,12].map(n => `
                      <button data-action="roulette-slots" data-count="${n}" ${spinning ? 'disabled' : ''}
                        class="px-3 py-1 rounded-lg text-sm font-bold ${slots === n ? 'bg-purple-500 text-white' : 'bg-black/30 text-purple-300 hover:bg-purple-500/30'} ${spinning ? 'opacity-50' : ''}">${n}</button>
                    `).join('')}
                  </div>
                </div>
                
                <div class="mb-6 max-h-48 overflow-y-auto space-y-2">
                  ${Array(slots).fill(0).map((_, i) => `
                    <div class="flex items-center gap-2">
                      <div class="w-4 h-4 rounded" style="background-color: ${ROULETTE_COLORS[i % ROULETTE_COLORS.length]}"></div>
                      <input type="text" data-roulette-input="${i}" maxlength="20" placeholder="${i+1}ë²ˆ"
                        class="input-dark flex-1 px-3 py-2 rounded-lg text-sm" value="${names[i] || ''}" ${spinning ? 'disabled' : ''}>
                    </div>
                  `).join('')}
                </div>

                <div class="flex gap-3">
                  <button data-action="spin-roulette" data-sound="spin" ${spinning ? 'disabled' : ''}
                    class="flex-1 btn-purple py-4 text-white font-bold text-xl rounded-2xl ${spinning ? 'opacity-50 cursor-not-allowed animate-pulse' : ''}">
                    ${spinning ? 'ğŸ¡ ëŒì•„ê°€ëŠ” ì¤‘...' : 'ğŸ¡ ëŒë¦¬ê¸°!'}
                  </button>
                  ${result !== null ? `<button data-action="reset-roulette" class="btn-secondary px-4 py-4 text-white rounded-2xl">â†»</button>` : ''}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDiceDots(value) {
      const dots = { 1: [[50,50]], 2: [[30,30],[70,70]], 3: [[30,30],[50,50],[70,70]], 4: [[30,30],[70,30],[30,70],[70,70]], 5: [[30,30],[70,30],[50,50],[30,70],[70,70]], 6: [[30,30],[70,30],[30,50],[70,50],[30,70],[70,70]] };
      return (dots[value] || dots[1]).map(([cx,cy]) => `<circle cx="${cx}" cy="${cy}" r="9" fill="#8B5A14" stroke="#6B4512" stroke-width="1"/>`).join('');
    }

    function renderMissionModal() {
      const room = state.room;
      const tile = TILES[room.currentTileId];
      if (!tile) return '';
      const players = Object.values(room.players).sort((a,b) => a.order - b.order);
      const currentPlayer = players[room.currentTurn];
      const isMyTurn = currentPlayer?.id === state.playerId;
      const goldenKey = room.goldenKeyCard;
      
      // í™©ê¸ˆì—´ì‡ ì¸ ê²½ìš°
      if (goldenKey) {
        return `
          <div class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
            <div class="relative animate-bounce-in">
              <div class="absolute -inset-6 bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-400 rounded-3xl blur-xl opacity-70 animate-golden-glow"></div>
              <div class="relative card-golden rounded-3xl p-8 max-w-sm w-full text-center animate-card-flip">
                <div class="text-8xl mb-4">${goldenKey.emoji}</div>
                <h2 class="text-3xl font-black text-amber-900 mb-2">ğŸ”‘ í™©ê¸ˆì—´ì‡  ğŸ”‘</h2>
                <p class="text-amber-800 mb-4">
                  <span class="font-bold">${currentPlayer?.name}</span>ë‹˜ì´ ë½‘ì•˜ìŠµë‹ˆë‹¤!
                </p>
                <div class="bg-amber-900/20 rounded-2xl p-4 mb-6 border-2 border-amber-600">
                  <p class="text-amber-900 text-xl font-bold">${goldenKey.text}</p>
                </div>
                
                ${isMyTurn ? `
                  <button data-action="${goldenKey.type === 'extra-roll' ? 'extra-roll' : 'close-mission'}" data-sound="success"
                    class="w-full py-3 bg-gradient-to-r from-amber-600 to-yellow-500 text-white font-bold rounded-xl hover:scale-105 transition-transform shadow-lg border-2 border-amber-400">
                    ${goldenKey.type === 'extra-roll' ? 'ğŸ² í•œ ë²ˆ ë” êµ´ë¦¬ê¸°!' : 'âœ¨ í™•ì¸!'}
                  </button>
                ` : `
                  <div class="py-3 bg-amber-900/20 text-amber-800 rounded-xl border-2 border-amber-600">
                    â³ ${currentPlayer?.name}ë‹˜ì´ í™•ì¸ ì¤‘...
                  </div>
                `}
              </div>
            </div>
          </div>
        `;
      }

      const colors = { drink: 'from-amber-600 to-orange-700', game: 'from-emerald-600 to-green-700', bonus: 'from-blue-600 to-indigo-700', move: 'from-purple-600 to-pink-700', special: 'from-yellow-500 to-amber-600', free: 'from-gray-500 to-gray-600', start: 'from-emerald-600 to-green-700' };
      const color = colors[tile.type] || colors.drink;
      let desc = tile.description;
      if (tile.name === 'ëœë¤ê²Œì„' && room.missionRandomGame) desc = room.missionRandomGame;

      return `
        <div class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
          <div class="relative animate-bounce-in">
            <div class="absolute -inset-4 bg-gradient-to-r ${color} rounded-3xl blur-xl opacity-60"></div>
            <div class="relative card-wood rounded-3xl p-8 max-w-sm w-full text-center">
              <div class="text-7xl mb-4">${tile.emoji}</div>
              <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r ${color} mb-2">${tile.name}</h2>
              <p class="text-amber-300 mb-4"><span class="text-amber-400 font-bold">${currentPlayer?.name}</span>ë‹˜ì˜ ë¯¸ì…˜!</p>
              <div class="bg-black/30 rounded-2xl p-4 mb-6 border border-amber-700/30">
                <p class="text-amber-100 text-lg font-medium">${desc}</p>
              </div>
              ${isMyTurn ? `
                <div class="flex gap-3">
                  ${tile.type === 'bonus' ? `<button data-action="extra-roll" data-sound="success" class="flex-1 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold rounded-xl hover:scale-105 transition-transform">ğŸ² í•œ ë²ˆ ë”!</button>` : ''}
                  <button data-action="close-mission" class="flex-1 py-3 bg-gradient-to-r ${color} text-white font-bold rounded-xl hover:scale-105 transition-transform">${tile.type === 'bonus' ? 'ë„˜ì–´ê°€ê¸°' : 'í™•ì¸!'}</button>
                </div>
              ` : `<div class="py-3 bg-black/30 text-amber-300/70 rounded-xl">â³ ${currentPlayer?.name}ë‹˜ í™•ì¸ ì¤‘...</div>`}
            </div>
          </div>
        </div>
      `;
    }

    function renderLeaveModal() {
      return `
        <div class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
          <div class="card-dark rounded-2xl p-6 max-w-sm w-full text-center animate-bounce-in">
            <div class="text-5xl mb-4">ğŸšª</div>
            <h3 class="text-xl font-bold text-white mb-2">ì •ë§ ë‚˜ê°€ì‹œê² ì–´ìš”?</h3>
            <p class="text-purple-300/70 text-sm mb-6">ë‚˜ê°€ë©´ ë‹¤ì‹œ ì°¸ì—¬í•  ìˆ˜ ì—†ì–´ìš”!</p>
            <div class="flex gap-3">
              <button data-action="hide-leave-confirm" class="flex-1 py-3 btn-secondary text-white font-bold rounded-xl">ì·¨ì†Œ</button>
              <button data-action="leave-room" data-sound="kick" class="flex-1 py-3 btn-danger text-white font-bold rounded-xl">ë‚˜ê°€ê¸°</button>
            </div>
          </div>
        </div>
      `;
    }

    function renderKickModal() {
      const player = state.room?.players?.[state.showKickConfirm];
      if (!player) return '';
      return `
        <div class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
          <div class="card-dark rounded-2xl p-6 max-w-sm w-full text-center animate-bounce-in">
            <div class="text-5xl mb-4">âš ï¸</div>
            <h3 class="text-xl font-bold text-white mb-2">${player.name}ë‹˜ì„ ì¶”ë°©?</h3>
            <p class="text-purple-300/70 text-sm mb-6">ì¶”ë°©ëœ í”Œë ˆì´ì–´ëŠ” ë‹¤ì‹œ ì°¸ì—¬ ë¶ˆê°€</p>
            <div class="flex gap-3">
              <button data-action="hide-kick-confirm" class="flex-1 py-3 btn-secondary text-white font-bold rounded-xl">ì·¨ì†Œ</button>
              <button data-action="kick-player" data-sound="kick" class="flex-1 py-3 btn-danger text-white font-bold rounded-xl">ì¶”ë°©</button>
            </div>
          </div>
        </div>
      `;
    }

    render();
  </script>
</body>
</html>
